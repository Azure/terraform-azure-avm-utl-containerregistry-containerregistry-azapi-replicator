# Task #37: timeouts.update - Proof Document

## Shadow Implementation

The `timeouts.update` field is already correctly implemented in `variables.tf`:

```hcl
variable "timeouts" {
  type = object({
    create = optional(string, "30m")
    delete = optional(string, "30m")
    read   = optional(string, "5m")
    update = optional(string, "30m")  # <-
  })
  default = {
    create = "30m"
    delete = "30m"
    read   = "5m"
    update = "30m"  # <-
  }
  nullable    = false  # <-
  description = <<-EOT
 - `create` - (Optional) Specifies the timeout for create operations. Defaults to 30 minutes.
 - `delete` - (Optional) Specifies the timeout for delete operations. Defaults to 30 minutes.
 - `read` - (Optional) Specifies the timeout for read operations. Defaults to 5 minutes.
 - `update` - (Optional) Specifies the timeout for update operations. Defaults to 30 minutes.  # <-
EOT
}
```

The output is already present in `migrate_outputs.tf`:

```hcl
output "timeouts" {
  value = var.timeouts  # <-
}
```

## Summary

The `timeouts.update` field is a Terraform provider meta-argument that controls the timeout duration for update operations. The default value from the provider (30 minutes) is already correctly configured in the variable definition, and the output is already present.

## Create Phase Verification

**Pattern:** Meta-argument (N/A for Azure API)

The `timeouts` block is not part of the Azure API schema. It is a Terraform provider meta-argument that controls operation timeout durations.

From `resourceContainerRegistry()` function (lines 57-62):

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(30 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(30 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(30 * time.Minute),
},
```

**Evidence:**
- Default value for Update: **30 minutes** (`30 * time.Minute`)
- This is a resource-level meta-argument, not a request body property

**Decision:** The timeout value is used by the parent module's `azapi_resource` block directly, not passed through the request body.

## Assignment Path Verification

**N/A** - Timeouts are not assigned to any Azure API request path. They are Terraform provider meta-arguments consumed directly by the `azapi_resource` block.

## Provider Schema

From `internal/services/containers/container_registry_resource.go` (lines 57-62):

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(30 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(30 * time.Minute),  // <- Update timeout
    Delete: pluginsdk.DefaultTimeout(30 * time.Minute),
},
```

**Key Details:**
- **Default Value:** `30 * time.Minute` (30 minutes)
- **Type:** Duration string
- **Optional:** Yes (falls back to default if not specified)

## Azure API Schema

**N/A** - Timeouts are not part of the Azure API schema. They are Terraform provider configuration.

## Hidden Fields

**N/A** - No hidden fields for timeout meta-arguments.

## Mapping

- Provider: `Update: pluginsdk.DefaultTimeout(30 * time.Minute)`
- Variable: `update = optional(string, "30m")`
- Default: `update = "30m"`
- Format conversion: `30 * time.Minute` → `"30m"`

## Special Handling

### Timeout Meta-Argument

The `timeouts` block is handled according to the special rules in `timeouts.md`:

1. **No shadow module implementation required** - Timeouts are not part of `local.body` or `local.sensitive_body`
2. **Variable configuration:**
   - Type definition: `update = optional(string, "30m")` ✅
   - Default block: `update = "30m"` ✅
   - Nullable: `false` ✅
   - Description: "Defaults to 30 minutes" ✅
3. **Output:** Already exists in `migrate_outputs.tf` ✅
4. **Consumed by parent module:** The value is passed directly to the parent module's `azapi_resource.timeouts` block

### Implementation Status

All requirements are already satisfied:
- ✅ Correct default value in type definition (`"30m"`)
- ✅ Correct default value in default block (`"30m"`)
- ✅ Both values are synchronized
- ✅ `nullable = false` is set
- ✅ Description mentions "Defaults to 30 minutes"
- ✅ Output exists in `migrate_outputs.tf`

## Deferred Work Completion

**N/A** - No deferred work found in `following.md` for this task.

## Critical Review & Edge Cases

### Null Semantics
- **Cannot be null:** `nullable = false` ensures the variable always has a value
- **Default applied:** If user doesn't specify `update`, defaults to `"30m"`

### Boundary Conditions
- **Minimum value:** Terraform duration strings accept any positive duration
- **Maximum value:** No enforced maximum, but Azure APIs have service-side timeouts
- **Format:** Must be a valid Go duration string (e.g., "30m", "1h", "90s")

### Idempotency
- **Always idempotent:** Timeout values don't affect resource state, only operation duration
- **No state impact:** Changing timeout doesn't trigger resource updates

### Safe References
- **Direct value passing:** The parent module passes `var.timeouts.update` directly to `azapi_resource`
- **Type safety:** The `optional(string, "30m")` ensures type correctness

### Edge Case Analysis

1. **User sets `update = null`:**
   - Prevented by `nullable = false` at the parent variable level
   - The `optional(string, "30m")` provides default

2. **User sets `update = ""`:**
   - Would result in invalid duration string
   - Terraform would error during plan/apply

3. **User sets very short timeout (e.g., "1s"):**
   - Allowed by schema, but operation will likely timeout
   - User responsibility to set appropriate values

4. **User sets very long timeout (e.g., "24h"):**
   - Allowed by schema
   - Azure service-side timeouts may still apply

## Checklist

- ✅ Property in correct location (variable definition only, not in locals)
- ✅ All logic exactly replicated from provider (default value: 30 minutes)
- ✅ Variable correctly configured with synchronized defaults
- ✅ Type definition default matches default block value
- ✅ `nullable = false` set correctly
- ✅ Description mentions correct default duration
- ✅ Output exists in `migrate_outputs.tf`
- ✅ No shadow module implementation needed (as per timeouts.md)
- ✅ Deferred work checked (none found)
- ✅ Critical review completed (null, edge, idempotent, safe refs)
- ✅ Edge Case Analysis included
- ✅ Proof created
- ✅ Ready to update `track.md` to Pending for check

---

## ✅ CHECKER VALIDATION - APPROVED

**Checked by:** Checker Agent
**Date:** 2026-01-26
**Task:** #37 - timeouts.update

### Validation Results

✅ **Timeout Default Value:** Correctly replicated from provider (30 minutes → "30m")
✅ **Type Definition Synchronization:** `optional(string, "30m")` matches `default = "30m"` ✅
✅ **Nullable Setting:** Correctly set to `false` ✅
✅ **Description Accuracy:** Correctly mentions "Defaults to 30 minutes" ✅
✅ **Output Configuration:** Output exists in `migrate_outputs.tf` ✅
✅ **No Shadow Module Implementation:** Correctly omitted per `timeouts.md` rules ✅
✅ **Deferred Work Completion:** No deferred work for this task ✅
✅ **Edge Cases:** All edge cases properly analyzed and handled ✅

### Compliance Statement

This implementation EXACTLY replicates the provider behavior as required by `executor.md` and `timeouts.md`. The timeout meta-argument is correctly configured with:
- Provider default (30 minutes) accurately converted to Terraform duration format ("30m")
- Type definition and default block perfectly synchronized
- Proper nullable constraint to prevent null values
- Correct output for parent module consumption
- No unnecessary shadow module implementation (meta-arguments handled at resource level)

No deviations, simplifications, or "safer alternatives" were found.

**Status:** APPROVED ✅

---
