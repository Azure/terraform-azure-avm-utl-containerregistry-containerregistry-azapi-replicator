# Task #5: admin_enabled - Proof Document

## Summary
The `admin_enabled` argument is a simple boolean flag that enables/disables the admin user on the Container Registry. It has a default value of `false`, is Optional, and can be updated in place (not ForceNew). The implementation adds it to `local.body.properties.adminUserEnabled` with `nullable = false` in the variable definition to ensure the default is always applied.

## Shadow Implementation
```hcl
# variables.tf
variable "admin_enabled" {
  type        = bool
  default     = false              # <-
  nullable    = false              # <-
  description = "(Optional) Specifies whether the admin user is enabled. Defaults to `false`."
}

# migrate_main.tf
locals {
  body = {
    properties = {
      adminUserEnabled = var.admin_enabled  # <-
    }
    sku = {
      name = var.sku
    }
  }
}
```

## Create Phase Verification

**Query Result**: The Create method (`resourceContainerRegistryCreate`) shows a single-phase creation pattern.

**Go Code Evidence** (lines 507-510):
```go
Properties: &registries.RegistryProperties{
    AdminUserEnabled: pointer.To(d.Get("admin_enabled").(bool)),
    Encryption:       expandEncryption(d.Get("encryption").([]interface{})),
    NetworkRuleSet:   networkRuleSet,
```

**Classification**: The `admin_enabled` field is set directly in the primary `CreateThenPoll` call within the `RegistryProperties`. This is a **Create phase** field, assigned in the main resource creation request.

**Decision**: Add to `local.body.properties` (not a post-creation operation).

## Assignment Path Verification

**Predicted Path**: `body.properties.adminUserEnabled`

**Go Code Trace**:
1. Line 509: `AdminUserEnabled: pointer.To(d.Get("admin_enabled").(bool))`
2. Line 507: Assigned to field in `&registries.RegistryProperties{...}`
3. Line 517: `Properties: &registries.RegistryProperties{...}` - nested under `Properties`
4. Line 495: Full struct is `parameters := registries.Registry{...}`
5. Line 524: Sent via `client.CreateThenPoll(ctx, id, parameters)`

**Verified Path**: `properties.adminUserEnabled`

**Path Comparison**: ✅ **MATCH** - Predicted path matches the verified assignment path in Go code.

## Provider Schema

**Source**: `internal/services/containers/container_registry_resource.go`, lines 86-90

```go
"admin_enabled": {
    Type:     pluginsdk.TypeBool,
    Optional: true,
    Default:  false,
},
```

**Schema Properties**:
- **Type**: `TypeBool`
- **Optional**: `true`
- **Default**: `false`
- **ForceNew**: Not present (can be updated in place)
- **Computed**: Not present
- **Sensitive**: Not present
- **Validation**: None

## Azure API Schema

**Resource Type**: `Microsoft.ContainerRegistry/registries@2025-04-01`

**Property Path**: `body.properties.adminUserEnabled`

**Type**: `Bool`

**Description**: "The value that indicates whether the admin user is enabled."

**Constraints**: Optional field, no specific constraints documented.

## Hidden Fields

**Check Result**: ✅ None detected

The provider code shows no hardcoded values or hidden fields related to `admin_enabled`. The field is directly mapped from Terraform configuration to Azure API without any transformations or additional logic.

## Mapping

**Terraform (snake_case)** → **Azure API (camelCase)**
- `admin_enabled` → `adminUserEnabled`

The mapping follows standard naming convention conversion: snake_case to camelCase, preserving the semantic meaning.

## Special Handling

### 1. Default Value
**Provider Behavior**: Schema defines `Default: false`

**Implementation**: 
```hcl
variable "admin_enabled" {
  type        = bool
  default     = false
  nullable    = false  # CRITICAL: Ensures default is always applied
  description = "(Optional) Specifies whether the admin user is enabled. Defaults to `false`."
}
```

**Rationale**: Following executor.md rules for top-level arguments with defaults: "Root/top-level arguments with defaults MUST have both `default` value AND `nullable = false` set". This ensures the default value is consistently applied even when the user doesn't explicitly set the variable.

### 2. ForceNew Handling
**Provider Behavior**: No `ForceNew: true` in schema, no CustomizeDiff logic for this field.

**Update Support Evidence** (lines 707-709):
```go
if d.HasChange("admin_enabled") {
    payload.Properties.AdminUserEnabled = pointer.To(d.Get("admin_enabled").(bool))
}
```

**Implementation**: ✅ No ForceNew trigger needed - field can be updated in place.

### 3. Validation
**Provider Behavior**: No validation functions in schema.

**Implementation**: ✅ No validation needed - simple boolean with no constraints.

### 4. Sensitive Handling
**Provider Behavior**: Field is not marked as `Sensitive: true`.

**Note**: While `admin_password` is a computed sensitive field, `admin_enabled` itself is just a boolean flag and is not sensitive.

**Implementation**: ✅ Add to `body`, not `sensitive_body`.

## Deferred Work Completion

**Check Result**: No work was deferred to this task in `following.md`.

## Critical Review & Edge Cases

### Edge Case Analysis

**1. Null Semantics**
- **Provider**: Default value of `false` is applied when not set
- **Implementation**: `nullable = false` ensures the default is always used, preventing null values
- ✅ **Behavior Match**: Exact replication of provider default handling

**2. Boolean Values**
- **True**: Enables admin user, causes computed fields `admin_username` and `admin_password` to be populated
- **False**: Disables admin user (default), computed fields remain empty
- ✅ **Implementation**: Direct passthrough of boolean value preserves all semantics

**3. Update Behavior**
- **Provider**: Line 707-709 shows `d.HasChange("admin_enabled")` - updates are explicitly supported
- **True → False**: Disables admin access
- **False → True**: Enables admin access and triggers credential generation
- ✅ **Implementation**: No ForceNew trigger allows in-place updates matching provider behavior

**4. Idempotency**
- **Provider**: Simple boolean assignment is inherently idempotent
- **Implementation**: Direct value assignment maintains idempotency
- ✅ **No order dependencies or stateful transformations**

**5. Safe References**
- **Provider**: Uses `d.Get("admin_enabled").(bool)` - direct type assertion on boolean
- **Implementation**: Direct variable reference with strong typing
- ✅ **No nested access requiring null checks**

**6. SKU Dependencies**
- **Check**: Reviewed CustomizeDiff (lines 286-345) for SKU-related constraints
- **Result**: No SKU restrictions for `admin_enabled` - works with all SKU tiers (Basic, Standard, Premium)
- ✅ **No conditional validation needed**

**7. Interaction with Other Fields**
- **Read Method** (lines 816-828): When `admin_enabled` is true, the provider fetches and sets `admin_username` and `admin_password`
- **Implementation Note**: These are computed outputs, not inputs we need to handle in migration
- ✅ **No cross-field dependencies requiring validation**

## Checklist

- ✅ Property in correct local (`body.properties.adminUserEnabled`)
- ✅ No ForceNew wrapping needed (field supports in-place updates)
- ✅ ALL logic EXACTLY replicated from provider (simple boolean passthrough with default)
- ✅ Validations: None needed (no validation functions in provider schema)
- ✅ TODO comment: Not applicable (not a sensitive field with independent variable)
- ✅ Hidden fields checked (none found)
- ✅ Deferred work: None to defer, none deferred to this task
- ✅ Critical review completed (null semantics, edge cases, idempotency, safe references)
- ✅ Edge Case Analysis included in proof
- ✅ Proof document created
- ✅ `track.md` will be updated to "Pending for check"
- ✅ Self-Review: Only `admin_enabled` implemented, no other task content added

---

## ✅ CHECKER VALIDATION - APPROVED

**Checked by:** Checker Agent
**Date:** 2026-01-26
**Task:** #5 - admin_enabled

### Validation Results

✅ **Root-Level Default Value:** Variable correctly implements both `default = false` AND `nullable = false` as required by executor.md for root-level arguments with defaults (lines 404-434)

✅ **Field Placement:** Field correctly placed in `local.body.properties.adminUserEnabled` (Create phase, not post-creation)

✅ **ForceNew Logic:** Correctly omitted from `replace_triggers_external_values` - provider supports in-place updates (no ForceNew in schema, Update method handles changes at lines 707-709)

✅ **Type Conversion:** Direct boolean passthrough - no conversion needed

✅ **Null Handling:** `nullable = false` with default ensures null values cannot override the default, matching provider behavior exactly

✅ **Validations:** None required - provider schema has no validation functions, no cross-field dependencies

✅ **Stable Keys:** Not applicable - field not in `replace_triggers_external_values`

✅ **Phase Detection:** Correctly identified as Create phase field (assigned in primary CreateThenPoll call)

✅ **Naming Convention:** Correct mapping `admin_enabled` → `adminUserEnabled`

✅ **Deferred Work Completion:** No deferred work exists (no `following.md` file)

✅ **Deferred Work Recording:** No deferrals made by this task

✅ **Edge Cases:** Comprehensive analysis covers null semantics, boolean values, update behavior, idempotency, safe references, SKU dependencies, and cross-field interactions

✅ **Proof Document Quality:** All mandatory sections present with Go code evidence, no forbidden phrases detected

### Compliance Statement

This implementation EXACTLY replicates the provider behavior as required by `executor.md`. The field is a simple boolean with a default value, correctly implemented with both `default` and `nullable = false` to ensure the default is always applied. The implementation supports in-place updates matching the provider's Update method behavior. No deviations, simplifications, or "safer alternatives" were found.

**Status:** APPROVED ✅

---
