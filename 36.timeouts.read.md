# Task #36: timeouts.read

## Summary
Verified the `read` timeout default value is correctly set to 5 minutes in the `timeouts` variable in `variables.tf`, matching the provider schema definition.

## Create Phase Verification

**Pattern:** Meta-block (N/A for Azure API)

The `timeouts` block is a Terraform provider meta-argument that controls how long the provider waits for operations to complete. It is NOT part of the Azure API request body.

From `resourceContainerRegistry()` in `internal/services/containers/container_registry_resource.go` (lines 57-62):

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(30 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(30 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(30 * time.Minute),
},
```

**Evidence:**
- Default value: **5 minutes**
- This is a resource-level meta-argument, not a request body property

## Implementation

The `timeouts` variable in `variables.tf` (lines 323-343) is already correctly configured:

```hcl
variable "timeouts" {
  type = object({
    create = optional(string, "30m")
    delete = optional(string, "30m")
    read   = optional(string, "5m")  # <- Already correct
    update = optional(string, "30m")
  })
  default = {
    create = "30m"
    delete = "30m"
    read   = "5m"  # <- Already synchronized with type definition
    update = "30m"
  }
  nullable    = false
  description = <<-EOT
 - `create` - (Optional) Specifies the timeout for create operations. Defaults to 30 minutes.
 - `delete` - (Optional) Specifies the timeout for delete operations. Defaults to 30 minutes.
 - `read` - (Optional) Specifies the timeout for read operations. Defaults to 5 minutes.  # <- Description correct
 - `update` - (Optional) Specifies the timeout for update operations. Defaults to 30 minutes.
EOT
}
```

The `output "timeouts"` in `migrate_outputs.tf` (lines 41-43) already exists:

```hcl
output "timeouts" {
  value = var.timeouts
}
```

**Key observations:**
- The type definition uses `optional(string, "5m")` with default "5m"
- The default block value is `read = "5m"` - perfectly synchronized
- The description correctly states "Defaults to 5 minutes"
- The parent module handles timeouts in its `timeouts` block
- No changes to shadow module are needed

**Verification:**
- The timeouts block is consumed directly by the parent module's `azapi_resource`
- The conversion: `5 * time.Minute` → `"5m"` is correct
- The `output "timeouts"` in `migrate_outputs.tf` passes the variable value to the parent module

## Assignment Path Verification

N/A - The `timeouts` block is not an Azure API property. It is a Terraform provider meta-argument.

## Provider Schema

From the provider source code (lines 57-62):

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(30 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),  // <- 5 minutes for read
    Update: pluginsdk.DefaultTimeout(30 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(30 * time.Minute),
},
```

## Azure API Schema

N/A - Timeouts are not part of the Azure API schema. They are Terraform provider-level configuration.

## Mapping

- Provider Go: `Read: pluginsdk.DefaultTimeout(5 * time.Minute)`
- Terraform HCL: `read = optional(string, "5m")` and `read = "5m"`

## Special Handling

**Timeouts Block Override (timeouts.md):**

Per the special override rules in `timeouts.md`:
1. ✅ Queried provider source code for timeout defaults
2. ✅ Verified variable `type` definition default matches `default` block value
3. ✅ Verified variable description matches the actual default duration
4. ✅ Confirmed `nullable = false` is set
5. ✅ Output "timeouts" exists in `migrate_outputs.tf`
6. ✅ No shadow module implementation needed (timeouts are meta-arguments)

**No code changes required** - The implementation already matches the provider schema exactly.

## Edge Case Analysis

**Null Semantics:** The `nullable = false` setting prevents null values. The default ensures a value is always present.

**Boundary Conditions:** The timeout value "5m" is reasonable for read operations.

**Idempotency:** Since this is a meta-argument, not data, idempotency is handled by Terraform's timeout mechanism.

**Safe References:** The parent module safely references `var.timeouts.read` since the variable is never null.

## Checklist

**Task:** #36 - timeouts.read

✅ **Type Definition:** `optional(string, "5m")` matches provider default of 5 minutes

✅ **Default Block:** `read = "5m"` correctly synchronized with type definition

✅ **Description:** Correctly states "Defaults to 5 minutes"

✅ **Nullable:** Set to `false` as required

✅ **Output:** `output "timeouts"` exists in migrate_outputs.tf

✅ **Shadow Module:** Correctly no implementation in migrate_main.tf (timeouts are meta-arguments)

✅ **Special Rules:** Followed timeouts.md override document exactly

✅ **Self-Review:** Only verified the read field, no other changes made

## Conclusion

This implementation EXACTLY replicates the provider behavior as required by `executor.md` and follows all special rules in `timeouts.md`. The timeout default value of 5 minutes is correctly extracted from the provider schema, properly synchronized between the type definition's `optional(string, "5m")` and the default block's `read = "5m"`, and the required `nullable = false` is correctly set. No deviations, simplifications, or "safer alternatives" were found. All values were already correct, requiring no code changes.

---

## ✅ CHECKER VALIDATION - APPROVED

**Checked by:** Checker Agent  
**Date:** 2026-01-26  
**Task:** #36 - timeouts.read

### Validation Results

✅ **Timeouts Block Override:** All rules from `timeouts.md` correctly followed  
✅ **Provider Default:** Exactly matches 5 minutes (`5 * time.Minute` → `"5m"`)  
✅ **Type Definition:** `optional(string, "5m")` correctly set  
✅ **Default Block:** `read = "5m"` correctly synchronized with type definition  
✅ **Nullable:** Set to `false` as required  
✅ **Description:** Correctly states "Defaults to 5 minutes"  
✅ **Output:** `output "timeouts"` exists in migrate_outputs.tf  
✅ **Shadow Module:** Correctly no implementation in migrate_main.tf (timeouts are meta-arguments)  
✅ **Deferred Work:** No deferred work from following.md (file doesn't exist)  
✅ **Synchronization:** Perfect sync between type definition and default block values  

### Compliance Statement

This implementation EXACTLY replicates the provider behavior as required by `executor.md` and follows ALL special rules in `timeouts.md`. The timeout default value of 5 minutes is correctly extracted from the provider schema (`Read: pluginsdk.DefaultTimeout(5 * time.Minute)`), properly synchronized between the type definition's `optional(string, "5m")` and the default block's `read = "5m"`, and the required `nullable = false` is correctly set. No deviations, simplifications, or "safer alternatives" were found. All values were already correct, requiring no code changes.

**Status:** APPROVED ✅

---
