# Task #33 - timeouts Block Structure Skeleton

## Summary

Created the structure skeleton for the `timeouts` block by updating the variable defaults in `variables.tf` and adding the output in `migrate_outputs.tf`. The `timeouts` block is a Terraform meta-argument that controls operation timeout durations and is NOT part of the Azure API request body. Therefore, no shadow module implementation is needed in `migrate_main.tf`.

## Create Phase Verification

**Pattern:** Meta-block (N/A for Azure API)

The `timeouts` block is a Terraform provider-level meta-argument, not an Azure API property. It is handled directly by the parent module's `azapi_resource` block and does not appear in the request body sent to Azure.

From `container_registry_resource.go` (lines 57-62):

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(30 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(30 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(30 * time.Minute),
},
```

**Evidence:**
- **Create timeout:** 30 minutes
- **Read timeout:** 5 minutes
- **Update timeout:** 30 minutes
- **Delete timeout:** 30 minutes

**Decision:** This is a resource-level meta-argument, not part of the request body. No implementation in shadow module's `locals` is required.

## Provider Schema

From the provider source code, the `timeouts` block is defined at the resource level:

```go
func resourceContainerRegistry() *pluginsdk.Resource {
    r := &pluginsdk.Resource{
        Create: resourceContainerRegistryCreate,
        Read:   resourceContainerRegistryRead,
        Update: resourceContainerRegistryUpdate,
        Delete: resourceContainerRegistryDelete,

        Timeouts: &pluginsdk.ResourceTimeout{
            Create: pluginsdk.DefaultTimeout(30 * time.Minute),
            Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
            Update: pluginsdk.DefaultTimeout(30 * time.Minute),
            Delete: pluginsdk.DefaultTimeout(30 * time.Minute),
        },

        Schema: map[string]*pluginsdk.Schema{
            // ... fields
        },
    }
    return r
}
```

## Azure API Schema

N/A - The `timeouts` block is not an Azure API property. It is a Terraform provider meta-argument that controls how long the provider waits for operations to complete.

## Implementation

### 1. Updated `variables.tf`

Modified the `timeouts` variable to include default timeout values extracted from the provider:

```hcl
variable "timeouts" {
  type = object({
    create = optional(string, "30m")
    delete = optional(string, "30m")
    read   = optional(string, "5m")
    update = optional(string, "30m")
  })
  default = {
    create = "30m"
    delete = "30m"
    read   = "5m"
    update = "30m"
  }
  nullable    = false
  description = <<-EOT
 - `create` - (Optional) Specifies the timeout for create operations. Defaults to 30 minutes.
 - `delete` - (Optional) Specifies the timeout for delete operations. Defaults to 30 minutes.
 - `read` - (Optional) Specifies the timeout for read operations. Defaults to 5 minutes.
 - `update` - (Optional) Specifies the timeout for update operations. Defaults to 30 minutes.
EOT
}
```

**Key changes:**
- Added `optional(string, "XXm")` with default values for each timeout field
- Set `default` block with values matching the type definition
- Set `nullable = false` to prevent null values
- Updated descriptions to document the default timeout durations

### 2. Added Output in `migrate_outputs.tf`

Added the `timeouts` output to allow the parent module to pass the timeouts value to its `azapi_resource` block:

```hcl
output "timeouts" {
  value = var.timeouts
}
```

### 3. No Shadow Module Implementation

**IMPORTANT:** No changes were made to `migrate_main.tf` because the `timeouts` block is not part of the Azure API request body. It is consumed directly by the parent module's `azapi_resource` block to control operation timeouts.

## Mapping

N/A - The `timeouts` block is a Terraform meta-argument and does not map to Azure API properties.

## Special Handling

### Timeouts Block Handling

The `timeouts` block is a special Terraform provider meta-argument that:
1. Does NOT appear in the Azure API request body
2. Controls how long the provider waits for operations to complete
3. Is handled directly by the parent module's `azapi_resource` block
4. Requires NO implementation in the shadow module's `locals`

### Variable Configuration Requirements

Per the executor guidelines for timeouts blocks:
- ✅ Default values in `type` definition MUST sync with `default` block values
- ✅ `nullable = false` MUST be set
- ✅ Description MUST document the default timeout durations
- ✅ Output MUST be added to `migrate_outputs.tf` if not already present

## Child Tasks Ready for Delegation

The `timeouts` block structure skeleton has been created with placeholder comments for each sub-field. The following child tasks are now ready for implementation:

| Task # | Field | Type | Status |
|--------|-------|------|--------|
| 34 | timeouts.create | Argument | Ready |
| 35 | timeouts.delete | Argument | Ready |
| 36 | timeouts.read | Argument | Ready |
| 37 | timeouts.update | Argument | Ready |

**Note:** Since this is a meta-block and the structure has been fully implemented with defaults in the variable definition, the child tasks will only need to verify the configuration and update the proof documents. No additional code changes are expected.

## Edge Case Analysis

### Null Handling
- **Configured:** `nullable = false` ensures the variable cannot be null
- **Default values:** All timeout fields have sensible defaults from the provider

### Boundary Conditions
- **Minimum timeout:** Terraform accepts any valid duration string (e.g., "1s", "1m")
- **Maximum timeout:** No explicit maximum; users control via the timeout string

### Idempotency
- **Guaranteed:** The variable has fixed defaults that match the provider's behavior
- **Consistent:** Values in `type` definition sync with `default` block

### Safe References
- **Parent module:** Can safely reference `module.shadow.timeouts` since it's never null
- **Type safety:** All fields are strings representing valid Go duration syntax

## Checklist

- ✅ Property in correct location (variables.tf, not migrate_main.tf)
- ✅ All logic EXACTLY replicated from provider (timeout defaults match)
- ✅ Validations IMPLEMENTED in variables.tf (type constraints via optional())
- ✅ Critical review (null semantics, defaults, idempotency)
- ✅ Edge Case Analysis in proof
- ✅ Proof created
- ✅ Output added to migrate_outputs.tf
- ✅ Variable defaults sync with type definition
- ✅ `nullable = false` set
- ✅ Description documents default timeout durations
- ✅ track.md updated to Pending for check

---

## ✅ CHECKER VALIDATION - APPROVED

**Checked by:** Checker Agent
**Date:** 2026-01-26
**Task:** #33 - timeouts

### Validation Results

✅ **Timeouts Block Handling:** Correctly identified as Terraform meta-argument, not Azure API property
✅ **Variable Configuration:** All default values in `type` definition sync with `default` block values
✅ **Nullable Setting:** `nullable = false` explicitly set as required
✅ **Output Configuration:** `output "timeouts"` exists in migrate_outputs.tf
✅ **Provider Schema:** Timeout values (30m, 5m, 30m, 30m) match provider source code evidence
✅ **No Shadow Module Implementation:** Correctly recognized that timeouts are handled by parent module's azapi_resource block
✅ **Description Accuracy:** All descriptions document the correct default timeout durations
✅ **Type Synchronization:** Each field's `optional(string, "XXm")` matches corresponding `default` value
✅ **Override Rules Compliance:** Follows all rules specified in timeouts.md override document
✅ **Deferred Work:** No following.md file exists, no deferred work to complete
✅ **Edge Cases:** Properly analyzed null handling, boundary conditions, and idempotency

### Compliance Statement

This implementation EXACTLY follows the rules specified in `executor.md` and the `timeouts.md` override document. The timeouts block is correctly recognized as a Terraform provider meta-argument and handled accordingly:

1. **Variable defaults sync perfectly** - All `optional(string, "XXm")` values match their corresponding `default` block values
2. **Timeout values are accurate** - Extracted from provider source code (30m create, 5m read, 30m update, 30m delete)
3. **No shadow module pollution** - Correctly avoided adding timeouts to migrate_main.tf locals
4. **Output properly configured** - Allows parent module to pass timeouts to azapi_resource block
5. **Nullable constraint enforced** - Prevents null values with `nullable = false`

No deviations, simplifications, or "safer alternatives" were found. The implementation precisely replicates the provider's timeout behavior through proper variable configuration.

**Status:** APPROVED ✅

---
